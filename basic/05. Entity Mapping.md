# 엔티티 매핑(Entity Mapping)

- 객체와 테이블 매핑
  - `@Entity, @Table`
- 기본 키 매핑
  - `@Id`
- 필드와 컬럼 매핑
  - `@Column`
- 연관관계 매핑
  - `@ManyToOne, @JoinColumn`

## @Entity

DB 테이블과 매핑할 클래스를 나타낸다. 이것을 엔티티(entity)라 부른다.

- 적용 시 주의 점!
  - 기본 생성자는 필수(접근제한자 : public or protected)
  - final 클래스, enum, interface, inner 클래스에는 사용 불가능
  - 저장할 필드에 final 사용 불가능

JPA 는 엔티티 객체를 생성할 때 `기본 생성자`를 사용한다.

## @Table

이 어노테이션을 생략하면, 엔티티 이름을 테이블 명으로 사용한다.

`name` 속성을 줘서 매핑할 테이블 이름을 지정할 수 있다.

## 데이터베이스 스키마 자동 생성

JPA 는 데이터베이스 스키마를 자동으로 생성하는 기능을 지원한다. JPA 는 `매핑 정보와 데이터베이스 방언(dialect)`을 사용해서 데이터베이스 스키마를 생성한다.

- persistence.xml 

```xml
<property name="hibernate.hbm2ddl.auto" value="create" />
```

- hibernate.hbm2ddl.auto 속성
  - create : 기존 테이블을 삭제하고 새로 생성한다.(DROP + CREATE)
  - create-drop : create 속성에 추가로 애플리케이션을 종료할 때 생성한 DDL 을 제거한다.
  - update : 데이터베이스 테이블과 엔티티 매핑정보를 비교해서 변경 사항만 수정한다.
  - validate : 데이터베이스 테이블과 엔티티 매핑정보를 비교해서 차이가 있으면 경고를 남기고 애플리케이션을 실행하지 않는다.
  - none : 자동 생성 기능을 사용하지 않으려면 hibernate.hbm2ddl.auto 속성 자체를 삭제하거나 none 을 주면 된다.

> 참고로 운영 서버에서는 create, create-drop, update 같은 DDL 을 수정하는 옵션은 절대 사용하면 안된다. 오직 로컬이나 개발 서버에서만 사용해야 한다. 이 옵션은 운영 중인 데이터베이스의 테이블이나 컬럼을 삭제할 수 있다.

- 추천 전략
  - 개발 초기 단계 : create or update
  - 초기화 상태로 자동화된 테스트를 진행하는 개발자 환경과 CI 서버는 create 또는 create-drop
  - 테스트 서버는 update 또는 validate
  - 스테이징 운영 서버는 validate 또는 none
 
> JPA 2.1 부터는 스키마 자동 생성 기능을 표준으로 지원한다. 하지만 하이버네이트 hibernate.hbm2ddl.auto 속성의 update 나 validate 는 지원하지 않는다.
